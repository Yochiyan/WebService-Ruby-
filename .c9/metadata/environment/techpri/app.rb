{"changed":true,"filter":false,"title":"app.rb","tooltip":"/techpri/app.rb","value":"require 'bundler/setup'\nBundler.require\nrequire 'sinatra/reloader' if development?\nrequire 'securerandom'\n\nrequire './photo_manager.rb'\nrequire './face_api_service.rb'\nrequire './search.rb'\n\nenable :sessions\n\n# 以下にコードを記載\nget '/' do\n  set_emotion(Emotions. happy)\n  erb :indexcd \nend\n\npost '/take_photo' do\nid = SecureRandom.uuid[0, 5]\nsave_photo(id, params[:photo1], params[:photo2], params[:photo3])\nredirect \"/photo/#{id}\"\nend\n\nget '/photo/:id' do \n  @src_array = read_photo(params[:id])\n  @id = params[:id]\n  erb :photo\nend\n# コードの記載終わり\n\n# --- ここからは写真を取る際に使われるコードです ---\n# beforeをつけることで、/take_photoのget・post通信が行われる前に処理をすることができます。\n# ここでは顔が検出されなかった場合・感情が足りなかった場合には、他の画面に移るという処理を書いています。\nbefore '/take_photo' do\n  if params[:message] == Results.noFace\n    redirect '/result/no_face'\n  elsif params[:message] == Results.lessEmotion\n    session[:emotion_value] = params[:emotion_value]\n    redirect \"/result/less_emotion\"\n  elsif params[:message] != Results.success\n    puts 'エラーが起きたみたい…もう一度試してね！'\n    redirect '/'\n  end\nend\n\n# 顔が検出されなかった場合のURIです。\nget '/result/no_face' do\n  erb :result_no_face\nend\n\n# 感情が足りなかった場合のURIです。\nget '/result/less_emotion' do\n  @emotion_percent_name = emotion_percent_name(session[:emotion])\n  @emotion_value = session[:emotion_value]\n\n  erb :result_less_emotion\nend\n\n# Emotionsに対応して、どのような文章を表示するかを決めています。\ndef emotion_percent_name(emotion)\n  if emotion.nil? || emotion.empty?\n    return '感情'\n  else\n    case emotion\n    when Emotions.angry then\n      return 'いかり度'\n    when Emotions.disgusted then\n      return 'うんざり度'\n    when Emotions.fearful then\n      return 'きょうふ度'\n    when Emotions.happy then\n      return 'えがお度'\n    when Emotions.neutral then\n      return 'まがお度'\n    when Emotions.sad then\n      return 'かなしみ度'\n    when Emotions.surprised then\n      return 'おどろき度'\n    else\n      return '感情'\n    end\n  end\nend\n","undoManager":{"mark":-2,"position":1,"stack":[[{"start":{"row":14,"column":12},"end":{"row":14,"column":13},"action":"insert","lines":["c"],"id":7},{"start":{"row":14,"column":13},"end":{"row":14,"column":14},"action":"insert","lines":["d"]}],[{"start":{"row":14,"column":14},"end":{"row":14,"column":15},"action":"insert","lines":[" "],"id":8}]]},"ace":{"folds":[],"scrolltop":844.5,"scrollleft":0,"selection":{"start":{"row":7,"column":21},"end":{"row":7,"column":21},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":51,"state":"start","mode":"ace/mode/ruby"}},"timestamp":1692078426885}